import React, { useState, useEffect } from "react";
import Typography from "@material-ui/core/Typography";
import Skeleton from "@mui/material/Skeleton";
import { useCookies } from "react-cookie";
import Button from "@mui/material/Button";
import { ImFolderUpload } from "react-icons/im";
import axios from 'axios';
import Header from './Header';

import Card from '@mui/material/Card';
import CardContent from '@mui/material/CardContent';
import CardMedia from '@mui/material/CardMedia';
import { CardActionArea } from '@mui/material';

const backimage = ["https://images.unsplash.com/photo-1611242320536-f12d3541249b?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80","https://images.unsplash.com/photo-1561016444-14f747499547?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1331&q=80","https://images.unsplash.com/photo-1588421357574-87938a86fa28?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80"]
function MalwareApi() {
  const [cookies, setCookies] = useCookies();
  const [result, setResult] = useState("No files added");
  const [isLoading, setIsLoading] = useState(false);
  const [color, setColor] = useState(2);
  const [unacceptedPosts, setUnacceptedPosts] = useState();
  const formHandler = async(e) => {
    setIsLoading(true);
    e.preventDefault();
    const file = e.target[0].files[0];
    console.log(file);
    const formData = new FormData();
    formData.append("file", file);
    formData.append("fileName", file.name);
    // console.log(formData); formdata cant be logged on the console. It will always give empty array
    try {
        const res = await axios.post(
        "https://infinite-stream-30636.herokuapp.com/checkfile",
        formData
        );
        console.log(res);
        console.log(typeof(`The file ${file.name} is maliciou`));
        if(res.data.result===`The file ${file.name} is maliciou`){
            localStorage.setItem('color',0);
        }
        if(res.data.result===`The file ${file.name} is legitimat`){
            localStorage.setItem('color',1);
        }
        setColor(parseInt(localStorage.getItem('color')));
        setResult(res.data.result);
        setIsLoading(false);
        localStorage.removeItem('color');
    } catch (ex) {
        console.log(ex);
    }
};
  
  useEffect(() => {
      
  }, []);
  return (
    <div className="api-total">
    <div className="header">
        <Header/>
    </div>
    <div className="api-main-area">
    <form onSubmit={formHandler} className="form-css-api">
        <input type="file" className="api-button" />
        <Button
        type="submit"
        endIcon={<ImFolderUpload />}
        variant="contained"
        >
        Upload
        </Button>
    </form>
    { isLoading ?  <Skeleton/> : 
    <Card sx={{ maxWidth: 345 , width: "100%"}}>
      <CardActionArea>
        <CardMedia
          component="img"
          height="300"
          image={backimage[color]}
          alt="green iguana"
        />
        <CardContent>
          <Typography gutterBottom variant="h5" component="div">
            Status
          </Typography>
          <Typography variant="body2" color="text.secondary">
            {result}
          </Typography>
        </CardContent>
      </CardActionArea>
    </Card>
    }
    </div>
    </div>
  );
}
export default MalwareApi;
